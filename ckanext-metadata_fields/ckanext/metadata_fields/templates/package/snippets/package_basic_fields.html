{% ckan_extends %}

{% set username = request.environ.get('REMOTE_USER') %}
{% if data.package_creator %}
	{% set package_creator = data.package_creator %}
{% else %}
	{% set package_creator = username %}
{% endif %}

{% set onepage = onepage or 0 %}

{% if data.title %}
	{% set new_dataset = False %}
{% else %}
	{% set new_dataset = True %}
{% endif %}

{% if new_dataset %}
	{% set form_field_wrapper_classes = 'dataset-form-field-wrapper field-with-info' %}
{% endif %}

{% block package_basic_fields_title %}
<div class="dataset-form-field-wrapper">
{{ form.input('title', id='field-title', label=_('Title'), placeholder=_('eg. A descriptive title'), value=data.title, error=errors.title, classes=['control-full', 'control-large', 'dataset-required'], attrs={'data-module': 'slug-preview-target'}) }}
</div>
{% endblock %}

{% block package_basic_fields_description %}
	<div>
		<div class="{{ form_field_wrapper_classes }}">
			{{ form.markdown('notes', id='field-notes', label=_('Description'), placeholder=_('eg. Some useful notes about the data'), value=data.notes, error=errors.notes, classes=['dataset-required']) }}
		</div>
		{% if new_dataset %}
			<div class="dataset-form-info-field dataset-form-info-field-height info-field">
				{% trans %}
				What is included in this file ? What are the main columns and pieces of data ?
				{% endtrans %}
			</div>
		{% endif %}
	</div>
	<span class="clear">&nbsp;</span>
{% endblock %}


{% block package_basic_fields_countries %}
{% if inheritied_form_style == 'edit' %} 
{{ h.snippet('package/snippets/country_dropdown.html', data=data, errors=errors, error_summary=error_summary, include_metadata=false, pkg_name=pkg_name, onepage=onepage, inheritied_form_style=inheritied_form_style) }}
  {% endif %}

  {% if inheritied_form_style != 'edit' %}
    <div id="select_groups_hidden" style="visibility:hidden;position:absolute;">
          {% if data.groups %}
          {% for group in data.groups %}
          <input id="field-group-{{ loop.index0 }}" type="checkbox" name="groups__{{loop.index0}}__id" value="{{group.id}}" checked="checked" class="group_checked"/>
          {% endfor %}
          {% endif %}
    </div>
   {% endif %}
{% endblock %}

{% block package_basic_fields_license %}
<div class="control-group dataset-required ">
  {% set error = errors.license_id %}
  <label class="control-label" for="field-license">{{ _("License") }}</label>
  <div class="controls">
    <select id="field-license" name="license_id" data-module="autocomplete">
      {% for license_desc, license_id in licenses  %}
      	{% if license_id %}
        <option value="{{ license_id }}" {% if data.get('license_id', 'notspecified') == license_id %}selected="selected"{% endif %}>{{ license_desc }}</option>
        {% endif %}
      {% endfor %}
    </select>
    {% if error %}<span class="error-block">{{ error }}</span>{% endif %}
    <span class="info-block info-inline">
      <i class="icon-info-sign"></i>
      {% trans %}
        License definitions and additional information can be found
        at <a href="http://opendefinition.org/licenses/">opendefinition.org</a>
      {% endtrans %}
    </span>
  </div>
</div>
<div id="licenses-other-define" {% if data.license_id != 'hdx-other' %}style="display:none;"{% endif %}>
	{{ form.markdown('license_other', id='field-license_other', label=_('Define License'), placeholder=_('Describe how people can and cannot use this data'), value=data.license_other, error=errors.license_other) }}
  </div>
{% endblock %}


{% block package_basic_fields_custom %}
	{% block package_basic_fields_custom_creator %}
	<!--<div class="control-group dataset-required">
        <label class="control-label" for="field-package-creator">{{ _('Creator') }} </label>
        <div class="controls">-->
			<input type="hidden" value="{{ package_creator }}" name="package_creator" id="field-package-creator"/>
		<!-- </div> 
	</div> -->
	{% endblock %}

	{% block basic_fields_source %}
		<div>
			<div class="{{ form_field_wrapper_classes }}">
	  		{{ form.input('dataset_source', id='field-dataset_source', label=_('Source'), placeholder=_('Enter the source(s) of the data'), value=data.dataset_source, error=errors.dataset_source, classes=['control-full','dataset-required']) }}
	  		</div>
	  		{% if new_dataset %}
		  		<div class="dataset-form-info-field info-field">
					{% trans %}
					Who actually collected the data ?
					{% endtrans %}
				</div>
			{% endif %}
		</div>
		<span class="clear">&nbsp;</span>
  	{% endblock %}

{% endblock %}

{% block package_basic_fields_tags %}
{# Switched this with metadata field Source #}
{% endblock %}

{# if onepage == 1 #}
{% block form_actions %}
{% endblock %}
{# endif #}