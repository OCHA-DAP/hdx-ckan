{% ckan_extends %}

{% if data.title %}
	{% set new_dataset = False %}
{% else %}
	{% set new_dataset = True %}
{% endif %}
{% if new_dataset %}
	{% set form_field_wrapper_classes = 'dataset-form-field-wrapper field-with-info' %}
{% endif %}

{% block package_metadata_fields %}
<div class="module-content graybg" {% if inheritied_form_style == 'edit' %}id="dataset_part_2_edit"{% else %}id="dataset_part_2"{% endif %}>
      <div class="package-upload-header-sm">{{ _("OPTIONAL DETAILS") }}</div>

  {% block dataset_fields %}

  {% block basic_field_date %}
  <div class="control-group" style="display:inline-block;">
  <label class="control-label" for="dataset_date">Date of Dataset</label>
    <div class="controls"> 
	  <input type="text" name='ui_dataset_date' id='field-ui_dataset_date' onkeydown="return false;"
	  	data-module='hdx_datepicker' data-module-group='1' data-module-topic='date-field-clicked' data-module-alt_field_id='field-dataset_date'
	  	label="{{_('Date of Dataset')}}" placeholder="{{_('Date of Dataset')}}" 
	  	error='{{errors.dataset_date}}' class='control-full'>
	  <input type="hidden" name='dataset_date' id='field-dataset_date' value='{{data.dataset_date}}' error='{{errors.dataset_date}}' />
	</div>
  <label class="control-label" for="dataset_date">Date Range</label>
    <div class="controls"> 
	  <input type="text" name='ui_date_range1' id='ui_date_range1' onkeydown="return false;"
	    data-module='hdx_datepicker' data-module-group='2' data-module-type="start-period" data-module-topic='date-field-clicked'
	    data-module-alt_field_id='date_range1'
	  	label="{{_('Start Date')}}" placeholder="{{_('Start Date')}}" value='' error='{{errors.dataset_date}}' class='control-full' style="width:95px;float:left; margin-right:2px;">
	  <input type="text" name='ui_date_range2' id='ui_date_range2' onkeydown="return false;"
		data-module='hdx_datepicker' data-module-group='2' data-module-type="end-period" data-module-topic='date-field-clicked'
		data-module-alt_field_id='date_range2'
	  	label="{{_('End Date')}}" placeholder="{{_('End Date')}}" value='' error='{{errors.dataset_date}}' class='control-full' style="width:95px; float:left; margin-right:2px;">
	  <input type="hidden" name='date_range1' id='date_range1' error='{{errors.dataset_date}}' />
	  <input type="hidden" name='date_range2' id='date_range2' error='{{errors.dataset_date}}' />
	</div>
</div>
    {% endblock %}

  {% block basic_field_methodology %}
  <div class="control-group">
    <div>
  <div id="field-dataset_methodology">
  <label class="control-label" for="methodology">Methodology</label>
    <div class="controls ">  
    <input type="radio" name="methodology" value="Census"> Census</input>
    </div>
    <div class="controls ">  
      <input type="radio" name="methodology" value="Sample Survey"> Sample Survey</input>
    </div>
    <div class="controls ">  
      <input type="radio" name="methodology" value="Direct Observational Data/Anecdotal Data"> Direct Observational Data/Anecdotal Data</input>
    </div>
    <div class="controls ">  
      <input type="radio" name="methodology" value="Registry"> Registry</div>
    <div class="controls ">  
      <input type="radio" name="methodology" id="meth_other_radio" value="Other"> Other</input>
	  <br><input type="text" name="method_other" id="method_other" style="width:30%; margin-left:20px;">
	  <br><br>
	  {% set py_meth='' %}
	  {% if data.methodology %}
	 	 {% set py_meth = h.markdown_extract_strip(data.methodology) %}
	  {% endif %}
    <script>
      var meth = "{{ py_meth }}";
      
      if(meth.length>0 && meth.match("Other") ){
        var other = meth.split(" - ");
        document.getElementById('method_other').value = other[1];
        meth = other[0];
      }
      
      var elements = document.getElementsByName("methodology");
      var checkedFlag = false;
      for(var e in elements){
        if(meth == elements[e].value){
          elements[e].checked = true;
          checkedFlag = true;
        }
      }
      //in any other case with "Other -" or not it will select the other option
      if(meth.length>0 && !checkedFlag){
        document.getElementById('meth_other_radio').checked = true;
      	document.getElementById('method_other').value = meth;
	  }

      var date = "{{data.dataset_date}}";
      if(date.match("-")){
        var range = date.split("-");
        //Clear single date field
        document.getElementById('field-dataset_date').value = '';

        //Set range
        document.getElementById('date_range1').value = range[0];
        document.getElementById('date_range2').value = range[1];       
      }
      
    </script>
    </div>
  </div>
</div>
</div>
  {% endblock %}

{% block package_basic_fields_tags %}
	<div class="dataset-form-field-wrapper">
	{% set tag_attrs = {'data-module': 'autocomplete', 'data-module-tags': '',
	'style':'width: 370px !important;',
	'data-module-source': '/api/2/util/tag/autocomplete?incomplete=?'} %}
	{{ form.input('tag_string', id='field-tags', label=_('Tags'), placeholder=_('eg. economy, mental health, government'), value=data.tag_string, error=errors.tags, classes=['control-full'], attrs=tag_attrs) }}
	</div>
{% endblock %}

  
  {% block basic_fields_caveats %}
  	<div>
	  	<div class="{{ form_field_wrapper_classes }}">
	  	{{ form.markdown('caveats', id='field-caveats', label=_('Caveats'), placeholder=_('Caveats'), value=data.caveats, error=errors.caveats) }}
	  	</div>
	  	{% if new_dataset %}
		  	<div class="dataset-form-info-field dataset-form-info-field-height info-field">
				{% trans %}
				Enter any potential caveats or comments (e.g. The dataset is not complete)
				{% endtrans %}
			</div>
		{% endif %}
	</div>
	<span class="clear">&nbsp;</span>
  {% endblock %}
    
    {# Replacing ajax-autocomplete with dropdown
    {% set group_attrs = {'data-module': 'autocomplete', 'data-module-source': '/api/2/util/group/autocomplete?q=?', 'data-module-key': 'id', 'data-module-label': 'title'} %}
    {{ form.input(group_name, label=_('Add Group'), id="field-group", value=data[group_name], classes=['control-medium'], error=errors.groups_list, attrs=group_attrs) }}
    #}
    
  {% endblock %}
  {% if inheritied_form_style != 'edit' %}
    <input name="save" type="hidden" value="go-resource"/>
  {% endif %}
</div>
{% endblock %}