this.ckan.module('followers-counter',function($){'use strict';return{options:{id:null,num_followers:0},initialize:function(){$.proxyAll(this,/_on/);this.counterEl=this.$('span');this.objId=this.options.id;this.sandbox.subscribe('follow-follow-'+this.objId,this._onFollow);this.sandbox.subscribe('follow-unfollow-'+this.objId,this._onUnfollow);},_onFollow:function(){this._updateCounter({action:'follow'});},_onUnfollow:function(){this._updateCounter({action:'unfollow'});},_updateCounter:function(options){var locale=$('html').attr('lang');var action=options.action;var incrementedFollowers;locale=locale?locale.replace('_','-'):locale;if(action==='follow'){incrementedFollowers=(++this.options.num_followers).toLocaleString(locale);}else if(action==='unfollow'){incrementedFollowers=(--this.options.num_followers).toLocaleString(locale);}
if(this.options.num_followers<1000){this.counterEl.text(incrementedFollowers);this.counterEl.removeAttr('title');}else{this.counterEl.attr('title',incrementedFollowers);}},teardown:function(){this.sandbox.unsubscribe('follow-follow-'+this.objId,this._onFollow);this.sandbox.unsubscribe('follow-unfollow-'+this.objId,this._onUnfollow);}}});