{% extends "package/base.html" %}

{% resource 'hdx_theme/hdx-datepicker.js' %}

{% set onepage = 1 %}

{% block toolbar %}
{{super()}}
{% endblock %}

{% block primary %}
<div class="paddingRowHack">
  <div class="paddingLeftHack paddingRightHack mTB45">
    <div class="row">
      <div class="span5 countrySelectorDiv">
        <div class="content">
          {% block country_list %}{{super()}}{% endblock %}
        </div>
      </div>
      <div id="country-map" class="span11 countryMapDiv">
      </div>
<!-- LEAFLET MAP -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.2/leaflet.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.2/leaflet.js"></script>
<style>

.svg-marker {
    -webkit-animation: hdxani 1s 1;
    cursor:pointer;
    background:transparent;
    -webkit-transform: translateX(-50%) translateY(-35px);
    height:35px;
    width: 35px;
    padding:0 8%;
    white-space: nowrap;
    color:#fff;
    font:500 14px/20px Arial;
    background-size:100%;
    background-image: url("data:image/svg+xml;utf8,<svg width='100%' height='100%' xmlns='http://www.w3.org/2000/svg'><path fill='rgb(242, 100, 90)' xmlns='http://www.w3.org/2000/svg' d='M16 0c-6.627 0-12 5.373-12 12s12 20 12 20 12-13.373 12-20-5.373-12-12-12zM16 20c-4.418 0-8-3.582-8-8s3.582-8 8-8 8 3.582 8 8-3.582 8-8 8zM16 8c-2.209 0-4 1.791-4 4s1.791 4 4 4 4-1.791 4-4-1.791-4-4-4z'/></svg>");
}

@-webkit-keyframes hdxani 
{
from {-webkit-transform: translateX(-50%) translateY(-100px);}
to {-webkit-transform: translateX(-50%) translateY(-35px);}
}
</style>
<script type='text/javascript'>
 
  if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position){
      var latitude = position.coords.latitude;
      var longitude = position.coords.longitude;
      });
 
      
      var map = L.map('country-map')
      var HDXIcon = L.divIcon({
    className: 'svg-marker',
    iconSize: [35,35],
    iconAnchor: [15,35]
      });
 
      L.tileLayer('https://{s}.tiles.mapbox.com/v3/reliefweb.im6jg6a0/{z}/{x}/{y}.png', {
    attribution: '<a href="http://www.mapbox.com/about/maps/" target="_blank">Terms &amp; Feedback</a>',
      maxZoom: 5
      }).addTo(map);
      
      map.locate({setView: true, maxZoom: 5});
 
      function onLocationFound(e) {
        var radius = e.accuracy / 2;
 
        L.marker(e.latlng,{
    icon: HDXIcon
}).addTo(map);
 
        //L.circle(e.latlng, radius).addTo(map);
      }
 
      map.on('locationfound', onLocationFound);
 
  }else {
      $('#country-map').html("Geolocation API is not supported in your browser. :(");
  }
 
</script>
<!-- LEAFLET MAP -->
    </div>
  </div>
</div>

  {% block primary_content %}
<div class="paddingRowHack graybg">
  <div class="paddingLeftHack paddingRightHack">
  <section class="module datasetModule">
    <div class="module-content" id="dataset_part_1">
      <div class="package-upload-header mTop45 sspBold20 mBottom40" style="color: #333333">1. {{ _("Tell us some details about your dataset") }}</div>
      {% block form %}{{ c.form | safe }}{% endblock %}
    </div>
    <div class="paddingLeftHack paddingRightHack" style="margin-top:0px;">
    </div>
  </section>
  </div>
</div>
      <div class="form-actions">
        {% block cancel_button %}
          <a class="btn" href="">{% block cancel_button_text %}{{ _('Cancel') }}{% endblock %}</a>
        {% endblock %}
        <button class="btn btn-primary" id="onepage_submit" name="save">{% block save_button_text %}{{ _('Next: Add Data') }}{% endblock %}</button>
      </div>



    {#
      <div class="module-content graybg" id="dataset_part_2">
        <div class="package-upload-header-sm">{{ _("OPTIONAL DETAILS") }}</div>
        {% block form2 %}{{ c.form | safe }}{% endblock %}
      </div>
      <div class="module-content" style="margin-top:0px;">
      <div class="form-actions">
        {% block cancel_button %}
          <a class="btn" href="">{% block cancel_button_text %}{{ _('Cancel') }}{% endblock %}</a>
        {% endblock %}
        <button class="btn btn-primary" type="submit" id="onepage_submit" name="save">{% block save_button_text %}{{ _('Next: Add Data') }}{% endblock %}</button>
      </div>
    </div>
    </section>
    #}
    {#
    <section class="module inactive">
      <div class="overlay"></div>
      <div class="module-content" id="dataset_part_3">
        <div class="package-upload-header">3. {{ _("ADD FILES") }}</div>
        {% block form3 %}{{ c.form | safe }}{% endblock %}
      </div>
    </section> #}

  {% endblock %}
{% endblock %}

{% block secondary %}
{% endblock %}

{%- block scripts2 %}
    {{ super() }}
<!-- <script src="/base/vendor/jquery.ui.widget.js"></script>
<script src="/base/vendor/jquery-fileupload/jquery.iframe-transport.js"></script>
<script src="/base/vendor/jquery-fileupload/jquery.fileupload.js"></script>
<script src="/base/vendor/jquery-fileupload/jquery.fileupload-ui.js"></script>-->

  <script>
  $('document').ready(function(){
    //Just in case of page back
    $('option[value=-1]').attr('selected', true);
     });
  </script>
{% endblock -%}

{% block styles %}
    {{ super() }}
    <link rel="stylesheet" href="/dataset_create.css" />
{% endblock %}
