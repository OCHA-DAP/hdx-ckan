{% extends "page.html" %}

{% block flash %}
  {# eat the flash messages so they don't remain in the session #}
  {% set flash_messages = h.flash.pop_messages() %}
{% endblock %}


{% block subtitle %}{{ _("Welcome") }}{% endblock %}

{% block maintag %}{% endblock %}

{% block header %}

<header class="newHeader">
  <div class="container">
    {# The .header-image class hides the main text and uses image replacement for the title #}
    <hgroup class="hdxLogo">

      {% block header_logo %}
        {% if g.site_logo %}
          <a class="logo" href="{{ h.url('home') }}"><img src="/images/homepage-new/logo-beta.png" alt="{{ g.site_title }} Logo" title="{{ g.site_title }} Logo" style="height: 31px; position: relative; top: -4px;"/><span id="hdxVersion">{{ h.hdx_version() }}</span></a>
        {% else %}
          <h1>
            <a href="{{ h.url('home') }}">{{ g.site_title }}</a>
          </h1>
          {% if g.site_description %}<h2>{{ g.site_description }}</h2>{% endif %}
        {% endif %}
      {% endblock %}
    </hgroup>

    <span class="content">
      <span class="navbar">
            <nav class="usermenu section">
              <ul class="mainLinks">
                {# ('organizations_index', _('Organizations')), #}

                {% block header_site_navigation_tabs %}
                {% if c.userobj %}
                  {{ h.build_nav_main(
                    ('about', _('About')),
                    ('search', _('Data')),
                    ('organizations_index', _('Organizations')),
                    ('http://docs.hdx.rwlabs.org/blog', _('Blog')),
                  ) }}
                {% else %}
                  {{ h.build_nav_main(
                    ('about', _('About')),
                    ('search', _('Data')),
                    ('organizations_index', _('Organizations')),
                    ('http://docs.hdx.rwlabs.org/blog', _('Blog')),
                  ) }}
                {% endif %}
                {% endblock %}
              </ul>
              <div class="pull-right">
                <ul class="nav nav-pills">
                  <li class="submitData">
                    <a href="{% if c.userobj %}/dataset/new{% else %}/contribute{% endif %}">
                      {{ _("Submit data") }}
                      <img src="/images/homepage-new/attachment.svg" style="width: 24px; height: 21px; margin-left: 20px;" />
                    </a>
                  </li>
                  {% if c.userobj %}
                  <li class="dropdown">
                    <a href="#" class="dropdown-toggle special-menuitem" data-toggle="dropdown">
                      {{ h.gravatar((c.userobj.email_hash if c and c.userobj else ''), size=29) }}
                      <span class="username">{{ h.markdown_extract(c.userobj.display_name, extract_length=15) }}</span>
                      <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu" role="menu">
                      {% block header_account_logged %}
                      {% if c.userobj.sysadmin %}
                      <li>
                        <a href="{{ h.url_for(controller='admin', action='index') }}" title="{{ _('Sysadmin settings') }}">
                          <i class="icon-legal"></i>
                          <span>{{ _('Sysadmin settings') }}</span>
                        </a>
                      </li>
                      {% endif %}
                      <li>
                        <a href="{{ h.url_for(controller='user', action='read', id=c.userobj.name) }}" class="image" title="{{ _('View profile') }}">
                          <i class="icon-user"></i>
                          <span>{{ _('Profile') }}</span>
                        </a>
                      </li>
                      <li class="notifications {% if c.new_activities > 0 %}notifications-important{% endif %}">
                        {% set notifications_tooltip = ngettext('Dashboard (%(num)d new item)', 'Dashboard (%(num)d new items)', c.new_activities) %}
                        <a href="{{ h.url_for(controller='user', action='dashboard') }}" title="{{ notifications_tooltip }}">
                          <i class="icon-dashboard"></i>
                          <span> {{ _('Dashboard') }} ({{ c.new_activities }})</span>
                        </a>
                      </li>
                      {% block header_account_settings_link %}
                      <li>
                        <a href="{{ h.url_for(controller='user', action='edit', id=c.userobj.name) }}" title="{{ _('Edit settings') }}">
                          <i class="icon-cog"></i>
                          <span>{{ _('User settings') }}</span>
                        </a>
                      </li>
                      {% endblock %}
                      {% block header_account_log_out_link %}
                      <li>
                        <a href="{{ h.url_for('/user/_logout') }}" title="{{ _('Log out') }}">
                          <i class="icon-signout"></i>
                          <span>{{ _('Log out') }}</span>
                        </a>
                      </li>
                      {% endblock %}
                      {% endblock %}
                    </ul>
                  </li>
                  {% else %}
                  {% block header_account_notlogged %}
                  <li class="newLogin">{% link_for _('Log in'), controller='user', action='login', class_='special-menuitem' %}</li>
                  <li class="newLogin">{% link_for _('Sign up'), controller='user', action='register', class_='btn' %}</li>
                  {% endblock %}
                  {% endif %}
                </ul>
              </div>
            </nav>
      </span>
    </span>

  </div>
</header>
{% endblock %}



{% block content %}
<div class="homepage-main">
  <div class="homepage-background">
    <div class="container">
      <div class="row blankRow">

      </div>
      <div class="row">
        <div class="span6 leftContent">
          <div class="row blankRow">
          </div>
          <div class="row">
            <div class="span6">
              <h1>
                {{ _("The humanitarian data exchange") }}
              </h1>
              <h3>
                {{ _("Where your data comes to life") }}
              </h3>
              <p class="hdxDescription">
                {{ _("This is an early version of the HDX Repository. Initially, you will be able to find
                      global datasets relevant to humanitarian work as well as local datasets from our
                      three pilot locations - Colombia, Kenya and Yemen. You can also create an
                      account and add your own data to the repository to share privately or publicly. 
                      Please have a look around and send us your feedback!") }}
              </p>
            </div>
          </div>

        </div>
        <div class="offset1 span5 rightContent">
          <div class="searchBox">
            <div class="searchHeader searchContent">
              <p>{{ _("Find data") }}</p>
            </div>

            <div class="searchContent firstSearch">
              {{ self.home_search() }}
              <div>
                <p class="exampleSearch">
                  {{ _("e.g.") }} <a href="{% url_for controller='package', action='search', q='preparedness data for Kenya' %}">{{ _("preparedness data for Kenya") }}</a>
                  {{ _("or") }} <a href="{% url_for controller='package', action='search', q='world health statistics' %}">{{ _("world health statistics") }}</a>
                </p>
              </div>
            </div>
            <div class="searchContent secondSearch">
              {{ self.group_select() }}
            </div>
          </div>

          <div class="row countRow">
            <div class="span6 hdxTextRow ">
              <div class="row">
                <div class="span2">
                  <div class="row">
                    <div class="span2 itemCount">
                      <a href="{% url_for 'search' %}"
                         data-module="count" data-url="{% url_for controller='ckanext.hdx_theme.count:CountController', action='dataset' %}">
                        0
                      </a>
                    </div>
                  </div>
                  <div class="row">
                    <div class="span2 itemName">
                      {{ _("Datasets") }}
                    </div>
                  </div>
                </div>

              <div class="span2">
                <div class="row">
                  <div class="span2 itemCount">
                    <a href="{% url_for 'group_index' %}"
                       data-module="count" data-url="{% url_for controller='ckanext.hdx_theme.count:CountController', action='country' %}">
                      0
                    </a>
                  </div>
                </div>
                <div class="row">
                  <div class="span2 itemName">
                    {{ _("Countries") }}
                  </div>
                </div>
              </div>

              <div class="span2">
                <div class="row">
                  <div class="span2 itemCount">
                    <a href="#"
                       data-module="count" data-url="{% url_for controller='ckanext.hdx_theme.count:CountController', action='source' %}">
                      0
                    </a>
                  </div>
                </div>
                <div class="row">
                  <div class="span2 itemName">
                    {{ _("Sources") }}
                  </div>
                </div>
              </div>

            </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}


{% block home_search %}
  <form class="form-search" method="get" action="{% url_for controller='package', action='search' %}">
    <div class="input-append">
      <input type="text" class="searchInput" name="q" value="{{ c.q }}" autocomplete="off" placeholder="{{ _("Search HDX Repository") }}">
      <button type="submit" class="button">
        <i class="icon-search"></i>
      </button>
    </div>
  </form>
{% endblock %}

{% block group_select %}
    <div class="dropdown selectCountryDropdown">
      <button class="dropdown-toggle selectCountry" data-toggle="dropdown">
        {{ _("Choose Country") }}
        <b class="caret"></b>
      </button>
      <ul class="dropdown-menu dropdown-inverse" role="menu" style="max-height: 241px; overflow-y: auto; min-height: 96px;">
        {% for group in c.group_package_stuff %}
          {% if group.type is defined %}
            {% set url = h.url_for(group.type + '_read', action='read', id=group.name) %}
              <li><a tabindex="-1" href="{{url}}">{{ group.display_name }}</a></li>
            {% endif %}
        {% endfor %}
      </ul>
    </div>
{% endblock %}

{% block footer %}
  <footer class="newFooter">
    <div class="container">
      <div class="row">
        <div class="span12">
          <span class="text">
            {{ _("A project by") }}:
          </span>
          <a href="http://www.unocha.org"><img src="/images/homepage/logo-ocha.png"/></a>
          <span class="text">
            {{ _("Related Sites") }}:
          </span>
          <a href="http://www.humanitarianresponse.info"><img src="/images/homepage/logo-humanitarianresponse-tall.png"/></a>
          <a href="http://reliefweb.int"><img src="/images/homepage/logo-reliefweb.png"/></a>
          <a href="http://fts.unocha.org/"><img src="/images/homepage/logo-fts.png"/></a>
          <span class="text">
            {{ _("Stay connected") }}:
          </span>
          <a href="http://www.twitter.com/humdata"><img src="/images/homepage-new/twitter.png"/></a>
          <a href="mailto:hdx@un.org"><img src="/images/homepage-new/email.png"/></a>
        </div>
      </div>
    </div>

    {% block footer_debug %}
      {% if g.debug %}
        {% include 'snippets/debug.html' %}
      {% endif %}
    {% endblock %}
  </footer>
{% endblock %}

{% block scripts %}
   {{ super() }}
   <link rel="stylesheet" href="/homepage.css">
   <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700' rel='stylesheet' type='text/css'>
   {% resource 'hdx_theme/count.js' %}
{% endblock %}

{# Remove the toolbar. #}

{% block toolbar %}{% endblock %}
